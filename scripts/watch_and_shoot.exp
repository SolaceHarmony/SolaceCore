#!/usr/bin/expect -f
# Continuous watcher: runs the app and takes a screenshot each time
# the given regex pattern appears in stdout. Keeps running until the
# app exits or you Ctrl+C the watcher.
# Usage: scripts/watch_and_shoot.exp {regex-pattern}

set timeout -1
if {$argc < 1} {
  puts "Usage: $argv0 {regex-pattern}"
  exit 1
}
set pattern [lindex $argv 0]

spawn ./gradlew :composeApp:run

expect {
  -re $pattern {
    puts "\n>>> trigger matched: $expect_out(0,string)\n"
    exec sh -c {python gpt5_screenshot.py tail 1 1}
    exp_continue
  }
  eof { exit 0 }
}

